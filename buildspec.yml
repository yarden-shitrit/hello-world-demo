version: 0.2
env:
  variables:
    ECR_REPO: 753392824297.dkr.ecr.us-east-1.amazonaws.com/hello-world-demo
phases:
  build:
    commands:
      - echo "Building a Docker image.."
      - docker build -t hello-world-demo:latest

      - echo "Tagging Docker image for ECR.."
      - docker tag myImage ${ECR_REPO}:${CODEBUILD_SOURCE_VERSION}

      - echo "Logging into ECR.."
      - aws ecr get-login-password --region $AWS_DEFAULT_REGION | docker login --username AWS --password-stdin $AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com
      
      - echo "Pushing Docker image to ECR.."
      - docker push ${ECR_REPO}:${CODEBUILD_SOURCE_VERSION}
      
      - echo "Done."